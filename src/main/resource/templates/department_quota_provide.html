<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:score="http://thymeleafexamples">
<head>
  <meta charset="utf-8">
  <title>部门指标发放</title>
  <!-- Bootstrap 3.3.7 -->
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="css/ionicons.min.css">
  <link rel="stylesheet" href="css/bootstrap-table.min.css">  
  <!-- DataTables -->
  <link rel="stylesheet" href="css/dataTables.bootstrap.min.css">  
  <link rel="stylesheet" href="css/buttons.bootstrap.min.css">
  <link rel="stylesheet" href="css/select.bootstrap.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="css/AdminLTE.min.css"> 
  <link rel="stylesheet" href="css/skins/skin-blue.min.css">

  <link href="css/bootstrap-editable.css" rel="stylesheet" />
  
  <!-- jQuery 3 -->
<script src="js/jquery.min.js"></script>
<!-- Bootstrap 3.3.7 -->
<script src="js/bootstrap.min.js"></script>

<!-- <script src="js/bootstrap-table-editable.min.js"></script> -->
<script src="js/bootstrap-editable.js"></script>
<script src="js/bootstrap-table.min.js"></script>
<script src="js/bootstrap-table-editable.min.js"></script>
<!-- DataTables -->
<script src="js/jquery.dataTables.min.js"></script>
<script src="js/dataTables.bootstrap.min.js"></script>

<script src="js/dataTables.buttons.min.js"></script>
<script src="js/buttons.bootstrap.min.js"></script>
<script src="js/dataTables.select.min.js"></script>

<script src="js/adminlte.min.js"></script>

<!-- SlimScroll -->
<script src="js/jquery.slimscroll.min.js"></script>
<!-- FastClick -->
<script src="js/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="js/adminlte.min.js"></script>

  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="js/html5shiv.min.js"></script>
  <script src="js/respond.min.js"></script>
  <![endif]-->
  <style >
 /*  editable-table-cell{
	  //background-color: yellow;
	 
	  "data-type": "text";
	  //"data-title": "用户名";
  } */
  /* inputclass{
  	width: 10px;
  } */
  .box-title{
  	position:relative;
  	left:41%;
  }
  </style>
 </head>
<body>
<div class="box">
<div class="box-body with-border">
    <span style="font-size:18px;position:relative;top:-3px;left:42.5%">部门指标发放<span style="font-size:10px;">&nbsp;&nbsp;(单位：升)</span></span>
	<p class="text-muted well well-sm" style="width:27%;position:absolute;top:-2px;left:73%">选择要发放指标的部门、油品后，可参考发放指标该油品的剩余数量，发放数量不能大于剩余可发放数量。</p>
	<table style="width:60%" class="table-bordered">		
	<tr style="align:center">		
		<td>
		   <select id="departmentInfo" class="form-control select2" style="width: 100%;">
               <option value="0">请选择部门</option>
               <option th:each="departmentInfo:${departmentProvideInfos}" th:value="${departmentInfo.departmentCode}" th:text="${departmentInfo.departmentName}">
			   </option>
         	</select>
		</td>		
		<td>
		   <select id="oiltype" class="form-control select2" style="width: 100%;">
               <option value="0">请选择油品</option>
               <option th:each="oil:${oilInfos}" th:value="${oil.oilType}" th:text="${oil.name}">
			   </option>
         	</select>
		</td>
		<td><input name="changenumber" type="text" class="form-control" placeholder="请输入发放数量(升)" disabled></td>
		<td style="width:25%"><button id="confirmchange" class="btn btn-warning btn-block" disabled>确认发放</button></td>
	</tr>
	</table>
</div></div>
<div class="box">          
<div class="box-header with-border">
	<h3 class="box-title">部门剩余指标统计表<span style="font-size:10px;">&nbsp;&nbsp;(单位：升)</span></h3>
</div>
<div class="box-body with-border ">
<div class="pre-scrollable">
<table class="table-bordered table-condensed" style="width:100%">
<thead>
	<tr style="font-size:16px;background-color:rgb(237, 241, 244);text-align:center;">
    	<th style="text-align:center">部门名称</th>
		<th th:each="obj:${oilInfos}" th:text="${obj.name+' (L)'}"></th>
	</tr>
</thead>
<tbody>
	<tr style="background-color:#00a65a;">
    	<td style="text-align:center">可发放指标合计</td>
    	<td th:each="oil:${oilInfos}" >
		<span th:each="obj:${provideSumInfos}" th:if="${(oil.oilType+'')==obj.oilType}" th:text="${obj.sum}"></span>
		</td>
	</tr>
	<tr style="background-color:#00a65a;">
    	<td style="text-align:center">部门剩余油品指标合计</td>
		<td style="width:10%;text-align:right;" th:each="sum:${totalInfo.oiltypeSum}" th:text="${sum}"></td>
	</tr>
</tbody>
</table>
</div>
<div class="pre-scrollable">
<table id="depart_infos" class="table table-hover table-striped table-bordered table-condensed">
  	<!-- <thead>
		<tr style="font-size:16px;background-color:rgb(237, 241, 244);text-align:center">
		<th style="text-align:center">部门名称</th>
		<th style="width:10%" th:each="obj:${oilInfos}" th:text="${obj.name}"></th>
		</tr>
  	</thead> -->
  	<tbody>
  		<tr th:each="obj:${departmentProvideInfos}" >
  			<td style="text-align:center" th:text="${obj.departmentName}" ></td>
  			<td style="width:10%;text-align:right;" th:each="sum:${obj.oiltypeSum}" th:text="${sum}"></td>
  		</tr>  
  	</tbody>
</table>
</div>
</div>
</div>

<script type='text/javascript' th:inline="javascript">
$(function(){	
	var provideSumInfos=[[${provideSumInfos}]];		
	$("#departmentInfo,#oiltype").on('change',function(){
		var departmentInfo=$("#departmentInfo").val();
		var oiltype=$("#oiltype").val();
		if(departmentInfo!=0&&oiltype!=0){
			$("input[name='changenumber']").attr('disabled',false);
			$("#confirmchange").attr('disabled',false);			
		}else{
			$("input[name='changenumber']").attr('disabled',true);
			$("#confirmchange").attr('disabled',true);
		}
	});
	var sum;
	$("#oiltype").on('change',function(){	
		var oiltype=$("#oiltype").val();
		for(i in provideSumInfos){
			//alert(provideSumInfos[i]);
			var code=provideSumInfos[i].oilType;
			if(oiltype==code){
				sum=provideSumInfos[i].sum;
				$("input[name='changenumber']").attr('placeholder',"最大发放量："+sum+"L");
			}
		}
	}); 
	$("#confirmchange").on('click',function(){
		$("#confirmchange").attr('disabled',true);
		var oiltype=$("#oiltype").val();
		var inputVal=$("input[name='changenumber']").val();
		var departmentInfo=$("#departmentInfo").val();
		if(inputVal==''){
			alert("请输入发放量");
			$("#confirmchange").attr('disabled',false);
			return;
		}
		if(inputVal>sum){
			alert("输入量："+inputVal +"大于 可发放量："+sum);
			$("input[name='changenumber']").val('');
			$("input[name='changenumber']").attr('placeholder',"最大发放量："+sum+"L");
			$("#confirmchange").attr('disabled',false);
			return;
		}
		var result=confirm('确定发放'+inputVal+'L');	
		$("#confirmchange").attr('disabled',false);
		$.ajax({
			url:'department-quota-provide/insert',
			data:{departmentCode:departmentInfo,oilType:oiltype,inputGuideline:inputVal},
			type:'post',
			success:function(data){
				alert(data);
			}
		});
	});
})
</script>
</body>
</html>
