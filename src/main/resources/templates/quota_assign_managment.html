<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:score="http://thymeleafexamples">
<head>
  <meta charset="utf-8">
  <meta name=renderer  content=ie-stand>
  <title>指标分配</title>
  <th:block th:replace="head-css.html"></th:block>
<style type="text/css">
.selected_tr{
background-color: #9ea1a2;
}
</style>
</head>
<body>
<div class="box">          
<div class="box-header with-border">
<table style="font-size:20px;width:60%"><tr>
	<td style="width:20%">本级指标分配</td>
	<td style="width:5%"><button id="quota_assign" class="btn btn-success btn-block">分配</button></td>
	<td style="width:5%"><button id="accounting" class="btn btn-warning btn-block">记账</button></td>
	<td style="width:5%"><button id="delete" class="btn btn-danger btn-block">删除</button></td>
	<td style="width:5%"><button id="print" class="btn btn-info btn-block">打印</button></td>
</tr></table>
</div>
<div class="box-body with-border ">
<div class="pre-scrollable">
<table id="title_table" class="table-bordered table-condensed" style="width:100%">
<thead>
	<tr style="font-size:12px;background-color:rgb(237, 241, 244);text-align:center;">
    	<th style="text-align:center;width:5%;" rowspan="2">记账标志</th>
		<th style="text-align:center;width:5%;" rowspan="2">单位</th>
		<th colspan="4" style="text-align:center">油料指标(吨)</th>
		<th colspan="7" style="text-align:center">油料经费(万元)</th>
	</tr>
	<tr style="font-size:12px;background-color:rgb(237, 241, 244);text-align:center;">
		<th style="text-align:center">油料小计</th>
		<th style="text-align:center">军队助供</th>
		<th style="text-align:center">自购主油</th>
		<th style="text-align:center">自购附油</th>
		<th style="text-align:center">经费小计</th>
		<th style="text-align:center">油料管理费</th>
		<th style="text-align:center">自购主油费</th>
		<th style="text-align:center">自购附油费</th>
		<th style="text-align:center">油库管理费</th>
		<th style="text-align:center">加油站管理费</th>
		<th style="text-align:center">业务管理费</th>
	</tr>
</thead>
<tbody>
	<tr style="background-color:#00a65a;">
    	<td colspan="2" style="text-align:center;width:10%;">上级指标分配</td>
    	<td style="text-align:center;width:5%;" th:text="${sjdb.yl_xiaoji}">0</td>
    	<td style="text-align:center;width:5%;" th:text="${sjdb.yl_jdzg}">0</td>
    	<td style="text-align:center;width:5%;" th:text="${sjdb.yl_zgzy}">0</td>
    	<td style="text-align:center;width:5%;" th:text="${sjdb.yl_zgfy}">0</td>
    	<td style="text-align:center;width:5%;" th:text="${sjdb.jf_xiaoji}">0</td>
    	<td style="text-align:center;width:5%;" th:text="${sjdb.jf_zgzy}">0</td>
    	<td style="text-align:center;width:5%;" th:text="${sjdb.jf_zgfy}">0</td>
    	<td style="text-align:center;width:5%;" th:text="${sjdb.jf_ykgl}">0</td>
    	<td style="text-align:center;width:5%;" th:text="${sjdb.jf_jyzgl}">0</td>
    	<td style="text-align:center;width:5%;" th:text="${sjdb.jf_ylywgl}">0</td>
    	<td style="text-align:center;width:5%;" th:text="${sjdb.jf_ylgl}">0</td>
	</tr>
	<tr style="background-color:#00a65a;">
    	<td colspan="2" style="text-align:center">上级指标调整</td>
    	<td style="text-align:center" th:text="${sjtz.yl_xiaoji}">0</td>
    	<td style="text-align:center" th:text="${sjtz.yl_jdzg}">0</td>
    	<td style="text-align:center" th:text="${sjtz.yl_zgzy}">0</td>
    	<td style="text-align:center" th:text="${sjtz.yl_zgfy}">0</td>
    	<td style="text-align:center" th:text="${sjtz.jf_xiaoji}">0</td>
    	<td style="text-align:center" th:text="${sjtz.jf_zgzy}">0</td>
    	<td style="text-align:center" th:text="${sjtz.jf_zgfy}">0</td>
    	<td style="text-align:center" th:text="${sjtz.jf_ykgl}">0</td>
    	<td style="text-align:center" th:text="${sjtz.jf_jyzgl}">0</td>
    	<td style="text-align:center" th:text="${sjtz.jf_ylywgl}">0</td>
    	<td style="text-align:center" th:text="${sjtz.jf_ylgl}">0</td>
	</tr>
	<tr style="background-color:#00a65a;">
    	<td colspan="2" style="text-align:center">分配合计</td>
    	<td style="text-align:center" th:text="${bjyfphj.yl_xiaoji}">0</td>
    	<td style="text-align:center" th:text="${bjyfphj.yl_jdzg}">0</td>
    	<td style="text-align:center" th:text="${bjyfphj.yl_zgzy}">0</td>
    	<td style="text-align:center" th:text="${bjyfphj.yl_zgfy}">0</td>
    	<td style="text-align:center" th:text="${bjyfphj.jf_xiaoji}">0</td>
    	<td style="text-align:center" th:text="${bjyfphj.jf_zgzy}">0</td>
    	<td style="text-align:center" th:text="${bjyfphj.jf_zgfy}">0</td>
    	<td style="text-align:center" th:text="${bjyfphj.jf_ykgl}">0</td>
    	<td style="text-align:center" th:text="${bjyfphj.jf_jyzgl}">0</td>
    	<td style="text-align:center" th:text="${bjyfphj.jf_ylywgl}">0</td>
    	<td style="text-align:center" th:text="${bjyfphj.jf_ylgl}">0</td>
	</tr>
</tbody>
</table>
</div>
<div class="pre-scrollable">
<table id="bjfp_table" class="table-condensed table-hover table-bordered">
 	<tbody>
  		<tr th:each="obj:${bjyfp}">
    	<td style="text-align:center;width:5%;" th:text="${obj.jizhang==1?'已记账':'未记账'}"></td>
    	<td style="text-align:center;width:5%;" th:text="${obj.danwei_name}">0</td>
    	<td style="text-align:center;width:5%;" th:text="${obj.yl_xiaoji}">0</td>
    	<td style="text-align:center;width:5%;" th:text="${obj.yl_jdzg}">0</td>
    	<td style="text-align:center;width:5%;" th:text="${obj.yl_zgzy}">0</td>
    	<td style="text-align:center;width:5%;" th:text="${obj.yl_zgfy}">0</td>
    	<td style="text-align:center;width:5%;" th:text="${obj.jf_xiaoji}">0</td>
    	<td style="text-align:center;width:5%;" th:text="${obj.jf_zgzy}">0</td>
    	<td style="text-align:center;width:5%;" th:text="${obj.jf_zgfy}">0</td>
    	<td style="text-align:center;width:5%;" th:text="${obj.jf_ykgl}">0</td>
    	<td style="text-align:center;width:5%;" th:text="${obj.jf_jyzgl}">0</td>
    	<td style="text-align:center;width:5%;" th:text="${obj.jf_ylywgl}">0</td>
    	<td style="text-align:center;width:5%;" th:text="${obj.jf_ylgl}">0</td>
		</tr>
		<tr th:each="obj:${bjwfp}" style="text-align:center;vertical-align:middle;">
		<td style="text-align:center;vertical-align:middle;width:5%;">未分配</td>
    	<td style="text-align:center;vertical-align:middle;width:5%;" th:text="${obj.bumen}">0</td>
    	<td style="text-align:center;vertical-align:middle;width:5%;" ><input type="text" value="油料小计" class="form-control" disabled></td>
    	<td style="text-align:center;vertical-align:middle;width:5%;" ><input type="text" class="form-control"></td>
    	<td style="text-align:center;vertical-align:middle;width:5%;" ><input type="text" class="form-control"></td>
    	<td style="text-align:center;vertical-align:middle;width:5%;" ><input type="text" class="form-control"></td>
    	<td style="text-align:center;vertical-align:middle;width:5%;" ><input type="text" value="经费小计" class="form-control" disabled></td>
    	<td style="text-align:center;vertical-align:middle;width:5%;" ><input type="text" class="form-control"></td>
    	<td style="text-align:center;vertical-align:middle;width:5%;" ><input type="text" class="form-control"></td>
    	<td style="text-align:center;vertical-align:middle;width:5%;" ><input type="text" class="form-control"></td>
    	<td style="text-align:center;vertical-align:middle;width:5%;" ><input type="text" class="form-control"></td>
    	<td style="text-align:center;vertical-align:middle;width:5%;" ><input type="text" class="form-control"></td>
    	<td style="text-align:center;vertical-align:middle;width:5%;" ><input type="text" class="form-control"></td>
		</tr>
  	</tbody>
</table>
</div>
</div>
</div>
<th:block th:replace="head-js.html"></th:block>
<script type='text/javascript' th:inline="javascript">
function refreshPage(){
	loadhtml('quota_assign_managment.htm');
}
$("#bjfp_table").on("click","tr",function(){
    $(".selected_tr").removeClass("selected_tr");
    $(this).addClass("selected_tr");
 });
$('#quota_assign').on('click',function(){
	$(this).attr('disabled',true);	
	var data=$(".selected_tr").children("td");
	var flag=data.eq(0).text();
	if(flag==""){
		alert_advance_warnning('请选择一行数据');
		$(this).attr('disabled',false);
		return;
	}
	var danwei_name=data.eq(1).text();
	
	var yl_jdzg=data.eq(3).find("input").val();
	var yl_zgzy=data.eq(4).find("input").val();
	var yl_zgfy=data.eq(5).find("input").val();
	var jf_zgzy=data.eq(7).find("input").val();
	var jf_zgfy=data.eq(8).find("input").val();
	var jf_ykgl=data.eq(9).find("input").val();
	var jf_jyzgl=data.eq(10).find("input").val();
	var jf_ylywgl=data.eq(11).find("input").val();
	var jf_ylgl=data.eq(12).find("input").val();
	
	if(yl_jdzg.length==0)
		yl_jdzg=0;
	if(yl_zgzy.length==0)
		yl_zgzy=0;
	if(yl_zgfy.length==0)
		yl_zgfy=0;
	
	if(jf_zgzy.length==0)
		jf_zgzy=0;
	if(jf_zgfy.length==0)
		jf_zgfy=0;
	if(jf_ykgl.length==0)
		jf_ykgl=0;
	if(jf_jyzgl.length==0)
		jf_jyzgl=0;
	if(jf_ylywgl.length==0)
		jf_ylywgl=0;
	if(jf_ylgl.length==0)
		jf_ylgl=0;
	//console.info(yl_jdzg+yl_zgzy+yl_zgfy);
	//console.info(jf_zgzy+jf_zgfy+jf_ykgl);
	//console.info(jf_jyzgl+jf_ylywgl+jf_ylgl);
	
	//console.info('['+(flag!="未分配")+flag+flag.length+']');
	if(yl_jdzg==0){		
		alert_advance('请输入助供分配数据');		
		$(this).attr('disabled',false);
		return;
	}
	/* 
	if(flag==""){
		//$('#label').text('请选择一行数据');
		//$('#info-modal').modal();	
		alert_advance_info('请选择一行数据');
		$(this).attr('disabled',false);
		return;
	} */
	else if(flag!="未分配"){
		//$('#label').text('请选择未分配单位');
		//$('#info-modal').modal();	
		alert_advance_info('请选择未分配单位');
		$(this).attr('disabled',false);
		return;
	}
	$.ajax({
		url:'quota_assign_managment/edit',
		type:'get',
		async:false,
		data:{"action":"assign","danwei_name":danwei_name,"yl_jdzg":yl_jdzg,"yl_zgzy":yl_zgzy,"yl_zgfy":yl_zgfy,"jf_zgzy":jf_zgzy,"jf_zgfy":jf_zgfy,"jf_ykgl":jf_ykgl,"jf_jyzgl":jf_jyzgl,"jf_ylywgl":jf_ylywgl,"jf_ylgl":jf_ylgl},
		success:function(result){
			alert_advance_success(result);
			refreshPage();
		},
	});
	$(this).attr('disabled',false);
});
$('#accounting').on('click',function(){		
	var data=$(".selected_tr").children("td");
	var flag=data.eq(0).text();
	var danwei_name=data.eq(1).text();
	//console.info('['+(flag!="未分配")+flag+flag.length+']');
	if(flag==""){
		/* $('#label').text('请选择一行数据');
		$('#info-modal').modal(); */
		alert_advance_warnning('请选择一行数据');
		return;
	}
	else if(flag!="未记账"){
		alert_advance_warnning('请选择未记账单位');
		/* $('#label').text('请选择未记账单位');
		$('#info-modal').modal();	 */
		return;
	}
	$.ajax({
		url:'quota_assign_managment/edit',
		type:'get',
		data:{"action":"accounting","danwei_name":danwei_name},
		success:function(result){
			alert_advance_success(result);
			refreshPage();
		},
	});
});
$('#delete').on('click',function(){		
	var data=$(".selected_tr").children("td");
	var flag=data.eq(0).text();
	//console.info('['+(flag!="未分配")+flag+flag.length+']');
	var danwei_name=data.eq(1).text();
	if(flag==""){
		alert_advance_warnning('请选择一行数据');
		//$('#info-modal').modal();
		return;
	}
	else if(flag!="未记账"){
		alert_advance_info('请选择未记账数据');
		//$('#info-modal').modal();
		return;
	}
	$.ajax({
		url:'quota_assign_managment/edit',
		type:'get',
		data:{"action":"delete","danwei_name":danwei_name},
		success:function(result){
			alert_advance_success(result);
			refreshPage();
		},
	});
});
$('#print').on('click',function(){		
	var data=$(".selected_tr").children("td");
	var flag=data.eq(0).text();
	//console.info('['+(flag!="未分配")+flag+flag.length+']');
	if(flag==""){
		alert_advance_warnning('请选择一行数据');
		//$('#info-modal').modal();	
	}
	else if(flag!="已记账"){
		alert_advance_warnning('请选择已记账单位');
		//$('#info-modal').modal();	
	}
});

</script>
</body>
</html>
