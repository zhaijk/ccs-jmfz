<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:score="http://thymeleafexamples">
<head>
  <meta charset="utf-8">
  <title>指标转换</title>
  <!-- Bootstrap 3.3.7 -->
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="css/ionicons.min.css">
  <link rel="stylesheet" href="css/bootstrap-table.min.css">  
  <!-- DataTables -->
  <link rel="stylesheet" href="css/dataTables.bootstrap.min.css">  
  <link rel="stylesheet" href="css/buttons.bootstrap.min.css">
  <link rel="stylesheet" href="css/select.bootstrap.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="css/AdminLTE.min.css"> 
  <link rel="stylesheet" href="css/skins/skin-blue.min.css">

  <link href="css/bootstrap-editable.css" rel="stylesheet" />
    <!-- jQuery 3 -->
  <script src="js/jquery.min.js"></script>
  <!-- Bootstrap 3.3.7 -->
  <script src="js/bootstrap.min.js"></script>

  <!-- <script src="js/bootstrap-table-editable.min.js"></script> -->
  <script src="js/bootstrap-editable.js"></script>
  <script src="js/bootstrap-table.min.js"></script>
  <script src="js/bootstrap-table-editable.min.js"></script>
  <!-- DataTables -->
  <script src="js/jquery.dataTables.min.js"></script>
  <script src="js/dataTables.bootstrap.min.js"></script>

  <script src="js/dataTables.buttons.min.js"></script>
  <script src="js/buttons.bootstrap.min.js"></script>
  <script src="js/dataTables.select.min.js"></script>

  <script src="js/adminlte.min.js"></script>

  <!-- SlimScroll -->
  <script src="js/jquery.slimscroll.min.js"></script>
  <!-- FastClick -->
  <script src="js/fastclick.js"></script>
  <!-- AdminLTE App -->
  <script src="js/adminlte.min.js"></script>
  
  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="js/html5shiv.min.js"></script>
  <script src="js/respond.min.js"></script>
  <![endif]-->
</head>
<body>	
<!-- <section class="content-header">
      <h1>
        Dashboard
        <small>Version 2.0</small>
      </h1>
      <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
        <li class="active">Dashboard</li>
      </ol>
    </section> -->
<div class="row">
<div class="col-md-12">
<div class="box">
<div class="box-body with-border">
    <span style="font-size:18px;position:relative;top:-3px;left:42.5%">转供油料指标转换<span style="font-size:10px;">&nbsp&nbsp(单位：吨)</span></span>
	<p class="text-muted well well-sm" style="width:27%;position:absolute;top:-2px;left:73%">须事先进行“油品密度定义”，将上级调拨的油料指标，根据事先定义的油品密度，转换成升，供为部门或IC卡发放指标使用。价拨油料作为实物使用时，也需进行转换；作为价拨使用时，不需转换。</p>
	<table style="width:50%" class="table-bordered">		
		<tr style="align:center">		
		<td><!-- <input type="select" class="form-control" placeholder="请选择油品"> -->
		   <select id="oiltype" class="form-control select2" style="width: 100%;">
               <option value="0">请选择油品</option>
               <option th:each="obj:${oilTypeInfos}" th:value="${obj.code}" th:text="${obj.name}">
			   </option>
         	</select>
		</td>
		<!-- <td><input name="danjuhao" type="text" class="form-control" placeholder="请输入单据号" disabled></td> -->
		<td><input name="changenumber" type="text" class="form-control" placeholder="请输入转换数量(吨)" disabled></td>
		<td style="width:25%"><button id="confirmchange" class="btn btn-warning btn-block">确认转换</button></td>
		<!-- <td><input style="font-color:red" class="form-control" type="text" name="" placeholder="可转换指标总数(吨)"  disabled></td>
		<td><input style="font-color:red" class="form-control" type="text" name="" placeholder="密度" disabled></td> -->
		</tr>
	</table>
</div></div></div></div>
<div class="row">
<div class="col-md-12">
<div class="box">
<div class="box-body with-border">
<span style="font-size:18px;position:relative;top:-3px;left:42.5%">转供油料指标转换统计表<span style="font-size:10px;">&nbsp&nbsp(单位：吨)</span></span>
<table class="table table-hover table-stripe table-bordered table-condensed">
    <thead>
    <tr>
    	<th>摘要</th>
    	<th>小计</th>
    	<th th:each="obj:${oilTypeInfos}" th:text="${obj.name}">    		
    	</th>
    </tr>
    </thead>
    <tbody>
    	<tr>
    		<td>批准转代供指标</td>
    		<td th:text="${zdgtotal}"></td>
    		<td th:each="obj:${oilTypeInfos}"></td>    	
    	</tr>
    	<tr th:each="obj:${zhuandaigongs}">
    		<td th:text="${obj.riqi}"></td>
    		<td th:text="${obj.shuliang}"></td>
    		<td th:each="obj:${oilTypeInfos}"></td>    	
    	</tr>
    	<tr>
    		<td>已加油数量</td>
    		<td th:text="${0}"></td>
    		<td th:each="obj:${oilTypeInfos}"></td>    	
    	</tr>
    	<tr th:each="obj:${zdgCardTrades}">
    		<td th:text="${obj.total}"></td>
    		<td th:text="${obj.oiltype}"></td>
    		<td th:each="obj:${oilTypeInfos}"></td>    	
    	</tr>
    	<tr>
    		<td>已转换指标</td>
    		<td th:text="${zdgtotal}"></td>
    		<td th:each="obj:${oilTypeInfos}"></td>    	
    	</tr>
    	<tr th:each="obj:${zdgZhs}">
    		<!-- <td th:text="${obj.total}"></td>
    		<td th:text="${obj.oiltype}"></td> -->
    		<td></td><td></td>
    		<td th:each="oil:${oilTypeInfos}">
    		
    		<span th:if="${oil.code.toString() eq obj.oiltype}" th:text="${obj.total}"></span>
    		</td>    	
    	</tr>
    </tbody>
</table>
</div></div></div></div>

<script type='text/javascript' th:inline="javascript">
$(function(){
	var oilTypeInfos=[[${oilTypeInfos}]];
	var balance=0;
	var density=0;
	var code;	
	$("#oiltype").change(function(){
		$("input[name='danjuhao']").val('');
		$("input[name='changenumber']").val('');
		code=$("#oiltype").val();
		if(code==0){
			$("input[name='danjuhao']").attr('disabled',true);
			$("input[name='changenumber']").attr('disabled',true);
			$("input[name='changenumber']").attr('placeholder','请输入转换数量(吨)');
			$("input[name='danjuhao']").attr('placeholder','请输入单据号');
			return;
		}
		var index=0;	
		for(i in oilTypeInfos){			
			if(oilTypeInfos[i].code==code){
				//index=i;
				balance=0;//totals.objs[index];
				//console.info(oilTypeInfos[i]);
				density=oilTypeInfos[i].density;
				break;
			}
		}		
		if(balance<=0){
			$("#confirmchange").attr('disabled',true);
			$("input[name='danjuhao']").attr('disabled',true);
			$("input[name='changenumber']").attr('disabled',true);
			$("input[name='changenumber']").attr('placeholder','剩余指标不足：'+balance+' 转换密度：'+density);
		}else{
			$("#confirmchange").attr('disabled',false);
			$("input[name='danjuhao']").attr('disabled',false);
			$("input[name='changenumber']").attr('disabled',false);
			$("input[name='changenumber']").attr('placeholder','剩余指标：'+balance+'t'+' 转换密度：'+density);
		}
	});
	$("#confirmchange").on('click',function(){	
		$("#confirmchange").attr('disabled',true);
		var changenumber=$("input[name='changenumber']").val();
		var danjuhao=$("input[name='danjuhao']").val();		
		if(changenumber>balance){
			alert_advance_info('输入值:'+changenumber+' 大于剩余指标:'+balance);return;
		}else if(changenumber<=0){
			alert_advance_info('转换数据:'+changenumber+' 无效');return;
		}else if(danjuhao.length==0){
			alert_advance_info('请输入单据号'+danjuhao.length+" "+danjuhao);return;
		}			
		$.ajax({
			url:'quota/shiwuzhuanhuan',
			type:'post',
			data:{"danjuhao":danjuhao,"changenumber":changenumber,"balance":balance,"density":density,"code":code},
			success:function(data){
				alert_advance_info(data);
				$("#confirmchange").attr('disabled',false);
			}						
		});		
	});
})
</script>
</body>
</html>
