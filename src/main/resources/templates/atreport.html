<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:score="http://thymeleafexamples">
<head>
  <meta charset="utf-8">
  <title>打印报表</title>
</head>

<body style="MARGIN: 0px; OVERFLOW-Y: hidden;OVERFLOW-X: hidden" onload="postxml();">
<table width="100%" height="400px">
<tr>
<td>
<button class=btn onclick="printPreview();">打印</button>

<button onclick="save();" >保存到Excel</button>
<button onclick="postxml();" >加载</button>
</td>
</tr>
<tr>
<td>
<object   classid="clsid:D0CB6A0C-E656-4BF4-BD2D-6AE5EC183D7C" id="EtCell1" 
	CODEBASE='ATGrid.CAB#version=2,1,8,411' width="100%" height="100%" >
  <param name="Border3D" value="false">
  
  <param name="Ruler" value="false">
  
  <param name="FileName" th:value="${pa_th}">  
 
</object>
</td>
</tr>


</table>

<textarea rows="2" name="ATGridData" cols="20" style='display:none'>

<?xml version="1.0" encoding="gb2312"?>

<EtCell>

<ETSet Name="ETSet1" Type="Delete" />

<ETSet Name="ETSet1" Type="Add" StartRow="3" EndRow="8"  FixedRows="true">
	<Field Name="Saler" Type="" Col="2" />
	<Field Name="Product" Type="" Col="3" />
	<Field Name="OutPrice" Type="" Col="4" />
	<Field Name="Count" Type="" Col="5" />
	<Field Name="LiRun" Type="" Col="6" />
</ETSet>

<ETSet Name="ETSet2" Type="Add" StartRow="3" EndRow="8" FixedRows="false">
	<Field Name="Saler" Type="" Col="8" />
	<Field Name="Product" Type="" Col="9" />
	<Field Name="OutPrice" Type="" Col="10" />
	<Field Name="Count" Type="" Col="11" />
	<Field Name="LiRun" Type="" Col="12" />
</ETSet>

<ETSet Name="ETSet3" Type="Add" StartRow="11" EndRow="14" FixedRows="true">
	<Field Name="Saler" Type="" Col="2" />
	<Field Name="Product" Type="" Col="3" />
	<Field Name="OutPrice" Type="" Col="4" />
	<Field Name="Count" Type="" Col="5" />
	<Field Name="LiRun" Type="" Col="6" />
</ETSet>

<RowData Type="MultiCol" FixedRows="true" >
	<ROW ID="1" ETSet="ETSet1">
		<Saler value="张君1" color="#ff0000" bgColor="#0000ff" />
		<Product value="Product1" />
		<OutPrice value="100" />
		<Count value="100" />
		<LiRun value="10" />
	</ROW>
	<ROW ID="2" ETSet="ETSet3">
		<Saler value="张君2" />
		<Product value="Product2" />
		<OutPrice value="200" />
		<Count value="200" />
		<LiRun value="20" />
	</ROW>
	<ROW ID="3" ETSet="ETSet1">
		<Saler value="张君" />
		<Product value="Product3" />
		<OutPrice value="300" />
		<Count value="300" />
		<LiRun value="10" />
	</ROW>
	<ROW ID="4" ETSet="ETSet3">
		<Saler value="高蓬" />
		<Product value="Product1" />
		<OutPrice value="400" />
		<Count value="400" />
		<LiRun value="40" />
	</ROW>
	<ROW ID="5" ETSet="ETSet1">
		<Saler value="高蓬" />
		<Product value="Product2" />
		<OutPrice value="500" />
		<Count value="500" />
		<LiRun value="50" />
	</ROW>
	<ROW ID="6" ETSet="ETSet3">
		<Saler value="赵光宝" href="http://www.webtea.com.cn/" />
		<Product value="Product1" />
		<OutPrice value="100" />
		<Count value="100" />
		<LiRun value="10" />
	</ROW>
	<ROW ID="7" ETSet="ETSet1">
		<Saler value="李福海1" />
		<Product value="Product1" />
		<OutPrice value="600" />
		<Count value="600" />
		<LiRun value="60" />
	</ROW>
	<ROW ID="8" ETSet="ETSet3">
		<Saler value="李福海1" />
		<Product value="Product2" />
		<OutPrice value="700" />
		<Count value="700" />
		<LiRun value="70" />
	</ROW>
	<ROW ID="9" ETSet="ETSet1">
		<Saler value="李福海2" />
		<Product value="Product3" />
		<OutPrice value="800" />
		<Count value="800" />
		<LiRun value="80" />
	</ROW>
	<ROW ID="10" ETSet="ETSet3">
		<Saler value="陶学科1" />
		<Product value="Product3" />
		<OutPrice value="800" />
		<Count value="800" />
		<LiRun value="80" />
	</ROW>
	<ROW ID="10" ETSet="ETSet2">
		<Saler value="陶学科1" />
		<Product value="Product3" />
		<OutPrice value="800" />
		<Count value="800" />
		<LiRun value="80" />
	</ROW>
	<ROW ID="10" ETSet="ETSet2">
		<Saler value="陶学科1" />
		<Product value="Product3" />
		<OutPrice value="800" />
		<Count value="800" />
		<LiRun value="80" />
	</ROW>
</RowData> 
</EtCell>
</textarea>
 <script language="JavaScript">
function NoInstall()
{
    var str="你必须首先安装ATGrid报表插件,才能进行WEB自定义报表设计!\n";
    str +="\n\n安装方法：在刚才弹出的\"安全设置警告\"对话中选择\"是(Y)\"";
    str +="\n\n那么将会自动安装ATGrid插件!\n\n";
    str +="\n\n可以重新返回上面的URL网址进行安装!\n\n谢谢合作!!!!!\n\n";
    alert_advance_info(str);
    //window.location.href = "http://www.etcell.com/";
}

function printPreview(){
var a = 1;
if(a==1){
	//alert_advance_info('abc');

	EtCell1.PrintPreviewEx("print-margin-top:60;print-margin-left:170;");
}else{
EtCell1.PrintPreview();
}
	
}
function printPreview1(){
	//alert_advance_info('abc');
	EtCell1.PrintPreview();

	
}
var i=1;
function postxml(){
	//alert_advance_info(1);
   var strXML = ATGridData.value;
   //alert_advance_info(2);
　　EtCell1.ImportXML(strXML);
   //setupdisplay();
   //alert_advance_info(3);
   //EtCell1.Redraw();
   //alert_advance_info(4);
}



function setupdisplay()
{
	//在ETSet数据集中，如果在xml中写了字段数据
	//那么虽然不显示，但是已经在ETSet数据集中存在了
	//通过下面的脚本让隐藏字段显示上指定的列上
	//这样就实现了交叉报表的功能
	var ppETSet3 = EtCell1.GetETSet("ETSet3");
	var ppETSet1 = EtCell1.GetETSet("ETSet1");
	var ppETSet2 = EtCell1.GetETSet("ETSet2");
	var ppETSet4 = EtCell1.GetETSet("ETSet4");	
	console.info(ppETSet3);
	ppETSet3.MoveFirst();
	for(ii=0;ii<ppETSet3.GetRecordCount();ii++)
	{
		strFldKey = ppETSet3.GetFieldValue("FldKey");
		ppCell = ppETSet3.GetFieldCell("Field1");
		
		//通过下面的脚本让隐藏字段显示上指定的列上
		ppETSet1.SetFieldProperty(strFldKey,"BindCol",ppCell.Col);
		ppETSet2.SetFieldProperty(strFldKey,"BindCol",ppCell.Col);
		ppETSet4.SetFieldProperty(strFldKey,"BindCol",ppCell.Col);
		
		ppETSet3.MoveNext();
	}
}

function setKey(){
  //在ETSet数据集中，如果在xml中写了字段数据
  //那么虽然不显示，但是已经在ETSet数据集中存在了
  //通过下面的脚本让隐藏字段显示上指定的列上
  //这样就实现了交叉报表的功能
  var ppETSet2 = EtCell1.GetETSet("ETSet2");
  var ppETSet1 = EtCell1.GetETSet("ETSet1");
  ppETSet2.MoveFirst();
  for(ii=0;ii<ppETSet2.GetRecordCount();ii++)
  {
    
    //通过下面的脚本让隐藏字段显示上指定的列上
    strFldKey = ppETSet2.GetFieldValue("FldKey");
  
    ppCell = ppETSet2.GetFieldCell("实物");
    ppETSet1.SetFieldProperty(strFldKey,"BindCol",ppCell.Col);
   
    ppCell2 = ppETSet2.GetFieldCell("价拨");
    ppETSet1.SetFieldProperty(strFldKey+'_价拨',"BindCol",ppCell2.Col);
    ppETSet2.MoveNext();
  }

}

function save(){
	var pathname = EtCell1.ShowDlgOpenFile('','*.xlsx',false);
	if(pathname!=''){
		if(EtCell1.SaveAs(pathname)){
			alert_advance_info('保存成功');
		}
	}
}
//postxml();

</script>
</body>
</html>
