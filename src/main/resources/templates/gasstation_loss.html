<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:score="http://thymeleafexamples">
<head>
  <meta charset="utf-8">
  <title>加油站损耗</title>
 <!-- Tell the browser to be responsive to screen width -->
  <meta content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" name="viewport">
  <th:block th:replace="head-css.html"></th:block>
  <style type="text/css">
  .dataTables_filter,.dataTables_info,.dataTables_paginate,#table_infos{
  	position:relative;
  	top:-40px;
  }
  input,select{
  text-align:center;
  }
  </style>
</head>
<body>	
<div class="box">
<div class="box-header with-border">
    <span style="font-size:20px;" >加油站损耗录入</span>	
	<p class="text-muted well well-sm" style="font-size:10px;width:40%;position:absolute;top:-2px;left:20%">由于油料提运过程的损失以及自然损耗，上级调拨的指标和实际可供使用的油料不相等，通过录入损耗数量，减少可供转换使用的指标，保持数据平衡。</p>
    <div class="btn-group" style="position:absolute;left:75%">	
		<button id="addRow" type="button"  class="btn  btn-default">
			<span class="glyphicon glyphicon-plus" aria-hidden="false"></span>新增
		</button>		
		<button  id="updateRow" type="button" class="btn  btn-default">
			<span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>修改
		</button>
		<button id="deleteRow" type="button" class="btn  btn-default">
			<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>删除
		</button>	
		<button id="confirmRow" type="button" class="btn  btn-default" disabled>
			<span class="glyphicon glyphicon-ok" aria-hidden="false"></span>确定
		</button>	
	</div>	
</div>
<div class="box-body with-border">
    <table >
<!-- 	<tr style="font-size:16px;background-color:rgb(237, 241, 244);align:center">
		<th style="width:5%">序号</th>
		<th style="width:7%">操作日期</th>
		<th style="width:5%">年度</th>
		<th style="width:6%">季度</th>
		<th style="width:8%">油品</th>		
		<th style="width:7%">实物损耗</th>	
		<th style="width:7%">价拨损耗</th>
		<th style="width:20%">备注</th>
    </tr> -->
    <tr style="text-align:center">
		<td style="width:5%">序号</td>
		<td style="width:7%">操作日期</td>
		<td style="width:5%">年度</td>
		<td style="width:6%">季度</td>
		<td style="width:8%">油品</td>		
		<td style="width:7%">实物损耗</td>	
		<td style="width:7%">价拨损耗</td>
		<td style="width:20%">备注</td>
    </tr>
	<tr><!-- text-align:left;vertical-align:middle; -->
        <td style="width:5%;"><input id="rowId" type="text" class="form-control" disabled></td>
	    <td style="width:7%"><input disabled id="date_oper" type="text" class="form-control" placeholder="日期"></td>
	    <td style="width:5%"><input id="year" type="text" class="form-control" placeholder="年度"></td>
	    <td style="width:6%">
	      <select id="period" class="form-control select2" style="width: 100%;">
            <option value="all">请选择季度</option>
            <option value="1">1季度</option>
            <option value="2">2季度</option>
            <option value="3">3季度</option>
            <option value="4">4季度</option>
       	  </select>
       	</td>
	    <td style="width:8%">
	    <select id="oil_type" class="form-control select2" style="width: 100%;">
            <option value="all">请选择油品</option>
            <option th:each="obj:${oilTypeInfos}" th:value="${obj.name}" th:text="${obj.name}">
	        </option>
       	</select>
	    </td>	   
	    <td style="width:7%"><input id="shiwuloss" type="text" class="form-control" placeholder="请输入实物损耗"></td>
	    <td style="width:7%"><input id="jiaboloss" type="text" class="form-control" placeholder="请输入价拨损耗"></td>
	    <td style="width:20%"><input id="memo" type="text" class="form-control" placeholder="备注"></td>	
	</tr>
	</table>
</div>
</div>
<div class="box">          
<div class="box-header with-border">
	<h3 class="box-title">加油站损耗明细表</h3>	
</div>
<div class="box-body with-border"> 
<table id="table_infos" class="table table-hover table-stripe table-bordered table-condensed">
<thead>
    <tr style="font-size:16px;background-color:rgb(237, 241, 244);align:center">
		<th style="width:5%">序号</th>
		<th style="width:7%">操作日期</th>
		<th style="width:5%">年度</th>
		<th style="width:6%">季度</th>
		<th style="width:8%">油品</th>		
		<th style="width:7%">实物损耗</th>	
		<th style="width:7%">价拨损耗</th>
		<th style="width:20%">备注</th>
    </tr>
</thead>
<tbody>  
</tbody>
</table>
</div>
</div>
<th:block th:replace="head-js.html"></th:block>
<script type='text/javascript' th:inline="javascript">
function loadtable(){
	table.ajax.reload();
}
var table=$('#table_infos').DataTable({
	'pageLength' : 8,
	'lengthChange' : false,
	'searching' : true,
	'info' : true,
	'autoWidth' : false,
  	"bDestroy":true,
		"bRetrieve":true,   		 
		"select": {
	        style: 'single',
	        info: false
	    },
	    "sort": false,
  	"ajax": "gasstation-loss-manager/datas",
  	"columns": [
  		{ "data": "id"},
  		{ "data": "lossdate"},
        { "data": "niandu"},
        { "data": "jidu"  },
        { "data": "oilName" },
        { "data": "zhugongsunhao"},
        { "data": "jiabosunhao"},
        { "data": "remark" }      
    ],
	"oLanguage": { //国际化配置  
		"sProcessing" : "正在获取数据，请稍后...",    
		"sLengthMenu" : "显示 _MENU_ 条",    
		"sZeroRecords" : "没有您要搜索的内容",    
		"sInfo" : "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",    
		"sInfoEmpty" : "记录数为0",    
		"sInfoFiltered" : "(全部记录数 _MAX_ 条)",    
		"sInfoPostFix" : "",    
		"sSearch" : "搜索",
		"sUrl" : "",    
		"oPaginate": {    
			"sFirst" : "首页",    
			"sPrevious" : "<<",    
			"sNext" : ">>",    
			"sLast" : "尾页"    
		}
	}
});  
$("#table_infos").on("click","tr",function(){    	
    var local=$(this).children("td");
    $("#rowId").val(local.eq(0).text());
    $("#date_oper").val(local.eq(1).text());
    $("#year").val(local.eq(2).text());    
    $("#period").val(local.eq(3).text());
    $("#oil_type").val(local.eq(4).text());
    $("#shiwuloss").val(local.eq(5).text());
    $("#jiaboloss").val(local.eq(6).text());
    $("#memo").val(local.eq(7).text());
}); 
//添加一条记录
$('#addRow').on('click',function(){  
  	$(this).attr('disabled',true)
    var year=$("#year").val();    
    var period=$("#period").val();
    var oil_type=$("#oil_type").val();
    var shiwuloss=$("#shiwuloss").val();
    var jiaboloss=$("#jiaboloss").val();
    var memo=$("#memo").val();
    var year=$("#year").val(); 
  	if(year==''){
  		alert_advance_info('请输入年份');
   		$(this).attr('disabled',false)
   		return;
   	} 
   	if(period=='all'){
  		alert_advance_info('请选择季度');
   		$(this).attr('disabled',false)
   		return;
   	}  	
   	if(oil_type=='all'){
  		alert_advance_info('请选择油品类型');
   		$(this).attr('disabled',false)
   		return;
   	}
   	if(shiwuloss==''||jiaboloss==''){
  		alert_advance_info('请输入实物、价拨损耗');
   		$(this).attr('disabled',false)
   		return;
   	}  	
    var result=confirm("确定添加"+" "+year+" "+period+" "+oil_type+" "+shiwuloss+" 信息");
    if(result==false){
    	$(this).attr('disabled',false)
    	return;
    }
   	$.ajax({
   		url:"gasstation-loss-manager/edit",
   		async:false,
   		type: 'post',
   		data:{"action":"insert","niandu":year,"jidu":period,"oilName":oil_type,"zhugongsunhao":shiwuloss,"jiabosunhao":jiaboloss,"remark":memo},
    	success:function(result){
			alert_advance_info(result);
		}
   	});
   	$(this).attr('disabled',false)
   	loadtable();
});
//删除一条记录
$('#deleteRow').on('click',function(){
	
	$(this).attr('disabled',true)
    var rowId=$("#rowId").val();
    var date_oper=$("#date_oper").val();
    var year=$("#year").val();    
    var period=$("#period").val();
    var oil_type=$("#oil_type").val();
    var shiwuloss=$("#shiwuloss").val();
    var jiaboloss=$("#jiaboloss").val();
    var memo=$("#memo").val();
    var result=confirm("确定删除 "+rowId+" "+year+" "+period+" "+oil_type+" "+shiwuloss);
    if(result==false){
    	$(this).attr('disabled',false)
    	return;    	
    }
    $.ajax({
    	url:"gasstation-loss-manager/edit",
    	async:false,
    	type: 'post',
    	data:{"action":"delete","id":rowId},
    	success:function(result){
			alert_advance_info(result);
		}
    });
    //if(result==true)
    //	table.row('.selected').remove().draw( false );
    $(this).attr('disabled',false)
    loadtable();
});
//更新    
$('#updateRow').on('click',function(){
	
	$(this).attr('disabled',true)
    var rowId=$("#rowId").val();
    var date_oper=$("#date_oper").val();
    var year=$("#year").val();    
    var period=$("#period").val();
    var oil_type=$("#oil_type").val();
    var shiwuloss=$("#shiwuloss").val();
    var jiaboloss=$("#jiaboloss").val();
    var memo=$("#memo").val();
    //var result=confirm("确定 "+rowId+" "+year+" "+period+" "+oil_type+" "+shiwuloss);   	
    if(rowId==''){
    	alert_advance_info('请选择一条操作记录')
    	$(this).attr('disabled',false)
    	return
    }	
    //console.info(danjuhao+' '+oiltype+' '+changeNumber);
    var result=confirm("确定更新"+rowId+" "+year+" "+period+" "+oil_type+" "+shiwuloss+"信息");
    if(result==false){
    	$(this).attr('disabled',false)
    	return;
    }
    $.ajax({
    	url:"gasstation-loss-manager/edit",
    	type: 'post',
    	async:false,
    	data:{"action":"update","id":rowId,"niandu":year,"jidu":period,"oilName":oil_type,"zhugongsunhao":shiwuloss,"jiabosunhao":jiaboloss,"remark":memo},
    	success:function(result){
			alert_advance_info(result);
		}
    });
    $(this).attr('disabled',false)
    loadtable();
});
</script>
</body>
</html>
