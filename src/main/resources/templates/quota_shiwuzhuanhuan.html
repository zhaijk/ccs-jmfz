<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:score="http://thymeleafexamples">
<head>
  <meta charset="utf-8">
  <title>指标转换</title>
  <!-- Bootstrap 3.3.7 -->
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="css/ionicons.min.css">
  <link rel="stylesheet" href="css/bootstrap-table.min.css">  
  <!-- DataTables -->
  <link rel="stylesheet" href="css/dataTables.bootstrap.min.css">  
  <link rel="stylesheet" href="css/buttons.bootstrap.min.css">
  <link rel="stylesheet" href="css/select.bootstrap.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="css/AdminLTE.min.css"> 
  <link rel="stylesheet" href="css/skins/skin-blue.min.css">

  <link href="css/bootstrap-editable.css" rel="stylesheet" />
    <!-- jQuery 3 -->
  <script src="js/jquery.min.js"></script>
  <!-- Bootstrap 3.3.7 -->
  <script src="js/bootstrap.min.js"></script>

  <!-- <script src="js/bootstrap-table-editable.min.js"></script> -->
  <script src="js/bootstrap-editable.js"></script>
  <script src="js/bootstrap-table.min.js"></script>
  <script src="js/bootstrap-table-editable.min.js"></script>
  <!-- DataTables -->
  <script src="js/jquery.dataTables.min.js"></script>
  <script src="js/dataTables.bootstrap.min.js"></script>

  <script src="js/dataTables.buttons.min.js"></script>
  <script src="js/buttons.bootstrap.min.js"></script>
  <script src="js/dataTables.select.min.js"></script>

  <script src="js/adminlte.min.js"></script>

  <!-- SlimScroll -->
  <script src="js/jquery.slimscroll.min.js"></script>
  <!-- FastClick -->
  <script src="js/fastclick.js"></script>
  <!-- AdminLTE App -->
  <script src="js/adminlte.min.js"></script>
  
  <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
  <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
  <!--[if lt IE 9]>
  <script src="js/html5shiv.min.js"></script>
  <script src="js/respond.min.js"></script>
  <![endif]-->
</head>
<body>	
<!-- <section class="content-header">
      <h1>
        Dashboard
        <small>Version 2.0</small>
      </h1>
      <ol class="breadcrumb">
        <li><a href="#"><i class="fa fa-dashboard"></i> Home</a></li>
        <li class="active">Dashboard</li>
      </ol>
    </section> -->
<div class="row">
<div class="col-md-12">
<div class="box">
<div class="box-body with-border">
    <span style="font-size:18px;position:relative;top:-3px;left:42.5%">实物油料指标转换<span style="font-size:10px;">&nbsp&nbsp(单位：吨)</span></span>
	<p class="text-muted well well-sm" style="width:27%;position:absolute;top:-2px;left:73%">须事先进行“油品密度定义”，将上级调拨的油料指标，根据事先定义的油品密度，转换成升，供为部门或IC卡发放指标使用。价拨油料作为实物使用时，也需进行转换；作为价拨使用时，不需转换。</p>
	<table style="width:70%" class="table-bordered">		
		<tr style="align:center">		
		<td><!-- <input type="select" class="form-control" placeholder="请选择油品"> -->
		   <select id="oiltype" class="form-control select2" style="width: 100%;">
               <option value="0">请选择油品</option>
               <option th:each="obj:${oilTypeInfos}" th:value="${obj.code}" th:text="${obj.name}">
			   </option>
         	</select>
		</td>
		<td><input name="danjuhao" type="text" class="form-control" placeholder="请输入单据号" disabled></td>
		<td><input name="changenumber" type="text" class="form-control" placeholder="请输入转换数量(吨)" disabled></td>
		<td style="width:25%"><button id="confirmchange" class="btn btn-warning btn-block">确认转换</button></td>
		<!-- <td><input style="font-color:red" class="form-control" type="text" name="" placeholder="可转换指标总数(吨)"  disabled></td>
		<td><input style="font-color:red" class="form-control" type="text" name="" placeholder="密度" disabled></td> -->
		</tr>
	</table>
</div></div></div></div>
<div class="row">
<div class="col-md-12">
<div class="box">
<div class="box-body with-border">
<div class="pre-scrollable">
<!-- <div class="box">
<div class="pre-scrollable">
<span style="font-size:18px;position:relative;top:2px;left:40%">统计表<small>吨</small></span>
<center><h4>实物油料指标统计表<small>吨</small></h4></center> -->
<!-- <span>实物油料指标统计表</span> -->
<span style="font-size:18px;position:relative;top:-3px;left:42.5%">实物油料指标统计表<span style="font-size:10px;">&nbsp&nbsp(单位：吨)</span></span>
<table  class="table-hover table-stripe table-bordered table-condensed">
	<thead>
	<tr style="font-size:14px;background-color:#d2d6de;align:center;">
		<th  >日期</th>
		<th  >指标类型</th>
		<th  >单据号</th>
		<th  >收入(吨)</th>
		<th  >已转换(吨)</th>
		<th  >结存(吨)</th>
		<th th:each="obj:${oilTypeInfos}">
			<span  th:text="${obj.name}"></span>	
		</th>
	</tr>
  </thead>
  <tbody>
  	<!-- <tr style="background-color:#00a65a;">
  		<td style="width:10%;">合计</td>
  		<td style="width:10%;"></td><td ></td>
  		<td style="width:5%;" th:text="${shouru}"></td>
  		<td style="width:5%;" th:text="${yizhuanhuan}"></td>
  		<td style="width:5%;" th:text="${heji}"></td>  		
		<td th:each="obj:${oilTypeInfos}"style="width:5%;"></td>
  	</tr> -->
  	<tr style="background-color:#00a65a;">
  		<td style="width:10%;">合计</td>
  		<td style="width:10%;"></td><td><span th:text="${shouru}"></span><span th:text="${yizhuanhuan}"></span><span th:text="${heji}"></span></td>
  		<td style="width:7%;" th:text="${totals.total}"></td>
  		<td style="width:7%;" th:text="${totals.change}"></td>
  		<td style="width:7%;" th:text="${totals.balance}"></td> 
		<td th:each="obj:${totals.objs}" style="width:5%">  
  		   <span th:if="${obj>=0}" th:text="${obj}"></span>
  		</td>		
  	</tr>  
  	</tbody>   
</table>
</div>
<div class="pre-scrollable">
<table class="table  table-hover table-stripe table-bordered table-condensed ">
 <!--  <thead  style="position:absolute;" class="pre-scrollable">
	<tr style="font-size:14px;background-color:#d2d6de;align:center;">
		<th style="width:10%;">日期</th>
		<th >指标类型</th>
		<th >单据号</th>
		<th >收入</th>
		<th >已转换</th>
		<th >结存</th>
		<th th:each="obj:${oilTypeInfos}">
			<span  th:text="${obj.name}"></span>	
		</th>
	</tr>
	<tr style="background-color:#00a65a;">
  		<td style="width:10%;">合计</td>
  		<td style="width:10%;"></td><td ></td>
  		<td style="width:5%;" th:text="${shouru}"></td>
  		<td style="width:5%;" th:text="${yizhuanhuan}"></td>
  		<td style="width:5%;" th:text="${heji}"></td>  		
		<td th:each="obj:${oilTypeInfos}"style="width:5%;"></td>
  	</tr>
  </thead> -->
  <tbody>
  	<!-- <tr style="background-color:#00a65a;">
  		<td>合计</td>
  		<td ></td><td ></td><td th:text="${shouru}"></td>
  		<td th:text="${yizhuanhuan}"></td><td th:text="${heji}"></td>
  		<span th:each="obj:${oilTypeInfos}">
			<td></td>	
		</span>
  	</tr>    -->
  	<tr style="background-color:#d2d6de">
  		<td style="width:10%;">本期实物收入</td>
  		<td style="width:10%;"></td><td></td><td th:text="${zhibiaoshourustotal.total}" style="width:7%;"></td>
  		<td style="width:7%;"></td><td style="width:7%;"></td>
		<td th:each="obj:${zhibiaoshourustotal.objs}" style="width:5%">  
  		   <span th:if="${obj>0}" th:text="${obj}"></span>
  		</td>		
  	</tr>  
  	<tr th:each="zbobj : ${zhibiaoshourus}">
  		<td th:text="${zbobj.riqi}"></td>
  		<td th:text="${zbobj.lx}"></td>
  		<td th:text="${zbobj.danjuhao}"></td>
  		<td th:text="${zbobj.sw}"></td><td ></td><td ></td>
  		<td th:each="oiltype:${oiltypes}">
  		  <span th:if="${zbobj.ypcode==oiltype}" th:text="${zbobj.sw}"></span>
  		</td>
  	</tr>
  	<tr style="background-color:#d2d6de">
  		<td>本期价拨收入</td>
  		<td ></td><td ></td><td th:text="${jiaboshourustotal.total}"></td>
  		<td ></td><td ></td>
		<td th:each="obj:${jiaboshourustotal.objs}" style="width:5%">  
  		   <span th:if="${obj>0}" th:text="${obj}"></span>
  		</td>
  	</tr> 
  	<tr th:each="zbobj:${zhibiaoshourus}">
  		<td th:text="${zbobj.riqi}"></td>
  		<td th:text="${zbobj.lx}"></td>
  		<td th:text="${zbobj.danjuhao}"></td>
  		<td th:text="${zbobj.jb}"></td><td ></td><td ></td>
  		<td  th:each="oiltype:${oiltypes}">
  		  <span th:if="${zbobj.ypcode==oiltype && zbobj.jb!='0'}" th:text="${zbobj.jb}"></span>
  		</td>
  	</tr> 
  	<tr style="background-color:#d2d6de">
  		<td>本期价拨支出</td>
  		<td ></td><td ></td><td ></td>
  		<td th:text="${jiabozhichustotal.total}"></td><td ></td>
  		<td th:each="obj:${jiabozhichustotal.objs}" style="width:5%">  
  		   <span th:if="${obj>0}" th:text="${obj}"></span>
  		</td>
  	</tr>
  	<tr th:each="jbzcobj:${jiabozhichus}">
  		<td></td><td></td><td></td>
  		<td></td><td th:text="${jbzcobj.jb}"></td><td></td>
  		<td th:each="oiltype:${oiltypes}">
  		  <span th:if="${jbzcobj.oil eq oiltype}" th:text="${jbzcobj.jb}"></span>
  		</td>
  	</tr>
  	<tr style="background-color:#d2d6de">
  		<td>代供外部</td>
  		<td ></td><td ></td><td ></td>
  		<td th:text="${daigongwaibustotal.total}"></td><td ></td>  		
		<td th:each="obj:${daigongwaibustotal.objs}" style="width:5%">  
  		   <span th:if="${obj>0}" th:text="${obj}"></span>
  		</td>
  	</tr> 
  	<tr th:each="daigongwaibu:${daigongwaibus}">
  		<td></td><td ></td><td></td>
  		<td th:text="${daigongwaibu.jb}"></td><td></td><td></td>
  		<td th:each="oiltype:${oiltypes}">
  		<span th:if="${daigongwaibu.oil eq oiltype}" th:text="${daigongwaibu.zg}"></span>
  		</td>  		
  	</tr>  
  	<tr style="background-color:#d2d6de">
  		<td>本期油料损耗</td>
  		<td ></td><td ></td><td ></td>
  		<td th:text="${shunhaosumtotal.total}"></td><td ></td>  		
		<td th:each="obj:${shunhaosumtotal.objs}" style="width:5%">  
  		   <span th:if="${obj>0}" th:text="${obj}"></span>
  		</td>
  	</tr>
  	<tr th:each="shunhao:${shunhaosum}">
  		<td ></td><td ></td><td ></td><td ></td><td th:text="${shunhao.sum}"></td><td ></td>
  		<td th:each="oiltype:${oiltypes}">
  		  <span th:if="${shunhao.oiltype eq oiltype}" th:text="${shunhao.sum}"></span>
  		</td>
  	</tr>
  	<tr style="background-color:#d2d6de">
  		<td>本期实物转换</td>
  		<td ></td><td ></td><td ></td>
  		<td th:text="${departmentIncomestotal.total}"></td><td ></td>  		
		<td th:each="obj:${departmentIncomestotal.objs}" style="width:5%">  
  		   <span th:if="${obj>0}" th:text="${obj}"></span>
  		</td>
  	</tr>
  	<tr th:each="departmentincome:${departmentIncomes}">
  		<td th:text="${departmentincome.provideDate2}"></td>
		<td th:text="${departmentincome.incomType}"></td>
		<td th:text="${departmentincome.danjuhao}"></td>
		<td ></td><td  th:text="${departmentincome.tonNum}"></td><td></td>
  		<td th:each="oiltype:${oiltypes}">
  		  <span th:if="${departmentincome.oilType.toString() eq oiltype}" th:text="${departmentincome.tonNum}"></span>
  		</td>
  	</tr> 
  </tbody>
</table>
</div></div></div></div></div>

<!-- <nav class="navbar navbar-default navbar-fixed-bottom ">
  <div class="container">
   	         <ul class="nav navbar-nav">
            <li ><a href="#">计划=><span class="sr-only">(current)</span></a></li>
            <li><a href="#">分配=></a></li>
            <li><a href="#">调拨=></a></li>
            <li><a href="#">发放=></a></li>
            <li><a href="#">储存=></a></li>
            <li><a href="#">消耗=></a></li>
            <li><a href="#">结转=></a></li>
          </ul>
          <form class="navbar-form navbar-left" role="search">
            <div class="form-group">
              <input type="text" class="form-control" id="navbar-search-input" placeholder="Search">
            </div>
          </form>
  </div>
</nav> -->
<!-- <nav class="navbar navbar-default navbar-fixed-top">
  <div class="container">
   顶部导航栏
  </div>
</nav> -->

<script type='text/javascript' th:inline="javascript">
$(function(){	
	var totals=[[${totals}]];
	var oiltypes=[[${oiltypes}]];
	var oilTypeInfos=[[${oilTypeInfos}]];
	var balance=0;
	var density=0;
	var code;
	$("#oiltype").change(function(){
		$("input[name='danjuhao']").val('');
		$("input[name='changenumber']").val('');
		code=$("#oiltype").val();
		if(code==0){
			$("input[name='danjuhao']").attr('disabled',true);
			$("input[name='changenumber']").attr('disabled',true);
			$("input[name='changenumber']").attr('placeholder','请输入转换数量(吨)');
			$("input[name='danjuhao']").attr('placeholder','请输入单据号');
			return;
		}
		var index=0;	
		for(i in oiltypes){
			if(oiltypes[i]==code){
				index=i;
				balance=totals.objs[index];
				//console.info(oilTypeInfos[i]);
				density=oilTypeInfos[i].density;
				break;
			}
		}		
		if(balance<=0){
			$("#confirmchange").attr('disabled',true);
			$("input[name='danjuhao']").attr('disabled',true);
			$("input[name='changenumber']").attr('disabled',true);
			$("input[name='changenumber']").attr('placeholder','剩余指标不足：'+balance);
		}else{
			$("#confirmchange").attr('disabled',false);
			$("input[name='danjuhao']").attr('disabled',false);
			$("input[name='changenumber']").attr('disabled',false);
			$("input[name='changenumber']").attr('placeholder','剩余指标：'+balance+'t'+' 转换密度：'+density);
		}
	});
	$("#confirmchange").on('click',function(){	
		$("#confirmchange").attr('disabled',true);
		var changenumber=$("input[name='changenumber']").val();
		var danjuhao=$("input[name='danjuhao']").val();		
		if(changenumber>balance){
			alert_advance_info('输入值:'+changenumber+' 大于剩余指标:'+balance);return;
		}else if(changenumber<=0){
			alert_advance_info('转换数据:'+changenumber+' 无效');return;
		}else if(danjuhao.length==0){
			alert_advance_info('请输入单据号'+danjuhao.length+" "+danjuhao);return;
		}			
		$.ajax({
			url:'quota/shiwuzhuanhuan',
			type:'post',
			data:{"danjuhao":danjuhao,"changenumber":changenumber,"balance":balance,"density":density,"code":code},
			success:function(data){
				alert_advance_info(data);
				$("#confirmchange").attr('disabled',false);
			}						
		});		
	});
})
</script>
</body>
</html>
