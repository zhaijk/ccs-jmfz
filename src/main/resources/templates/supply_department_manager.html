<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:score="http://thymeleafexamples">
<head>
  <meta charset="utf-8">
  <title>供应单位定义</title>
  <th:block th:replace="head-css.html"></th:block>
  <th:block th:replace="head-js.html"></th:block>
  <style> .display{
            text-align: center
        }
 	.dataTables_filter{
 		width:10px;
 		position:absolute; 	
 		top:-40px;
 		left:10%;
 	}
 	/* #toolbar{
 		position:relative;
 		top:0px;
 		left:74%;
 	} */
 	 .box-title{
 		position:relative;
 		top:10px;
 	} 
  </style>
 </head>
<body>	
<div class="row">
<div class="col-md-6">  
<div class="box">        
<div class="box-header with-border">
<table class="box-title"><tr>
<td style="width:45%">	
	<h4>供应单位定义</h4>
</td>
<td>
    <select id="junqu_select" class="form-control selectpicker "  data-style="btn-info">       
    </select>
</td>
<td>
    <button id="addRow" type="button" class="btn btn-info">添加</button>
</td>
<td>
    <button id="delRow" type="button" class="btn btn-info">删除</button>
</td>
	</tr>
	</table>

</div>
<div class="box-body with-border">
	<table id="table_infos" class="table table-hover table-stripe table-bordered table-condensed">
	<thead>	
		<tr style="font-size:16px;background-color:rgb(237, 241, 244);align:center">
		<th style="width:10%">序号</th>
		<th style="width:15%">单位代码</th>
		<th style="width:20%">单位名称</th>
		<th style="width:10%">标志</th>	
		</tr>
	</thead>
	</table>	
</div></div></div>
<div class="col-md-6">   
<div class="box">        
<div class="box-header with-border">

<table class="box-title">
<tr>
<td style="width:33%">
<h4 >受供单位定义</h4>
</td>
<td>
    <input type="text" class="input-mini form-control" id="departCode" placeholder="单位编码">
</td>
<td>
    <input type="text" class="input-mini form-control" id="departName" placeholder="单位名称">
</td>
<td>
    <button id="addRow" type="button" class="btn btn-info">添加</button>
</td>
<td>
    <button id="delRow" type="button" class="btn btn-info">删除</button>
</td>
</tr>
</table>
</div>
<div class="box-body with-border">
	<table id="recv_table" class="table table-hover table-stripe table-bordered table-condensed">
	<thead>	
		<tr style="font-size:16px;background-color:rgb(237, 241, 244);align:center">
		<th style="width:10%">序号</th>
		<th style="width:20%">单位代码</th>
		<th style="width:20%">单位名称</th>
		<th style="width:10%">级次</th>	
		</tr>
	</thead>
	</table>	
</div></div></div>
</div>

<script type='text/javascript' th:inline="javascript">
$(function(){	
	var table;
	var recv_table;
	function loadtable(){
		table.ajax.reload();
	}
	function init_recv(){
		recv_table=$('#recv_table').DataTable({
			 	"pagingType":   "full",
			 	"jQueryUI": false,
				'pageLength' : 10,
				'lengthChange' : false,
				'searching' : false,
				'info' : true,
				'autoWidth' : false,
			  	"bDestroy":true,
		   		"bRetrieve":true,   		 
		   		"select": {
		   	        style: 'single',
		   	        info: ''
		   	    },   	   
		   	    "sort": true,
		   	 	//"order": [1,'asc'],  	
			  	"aoColumnDefs":[{"bSortable": false,"aTargets":[1,2,3]}],
			  	"ajax": "recviver_department_manager/datas",
			  	"columns": [
			  		{ "data": "id"},
			  		{ "data": "bumen_code"},
		            { "data": "bumen"},
		            { "data": "jici"}/* ,
		            { "data": "biaozhi"},
		            { "data": "paixu"} */
		        ],
		    	"oLanguage": { //国际化配置  
					"sProcessing" : "正在获取数据，请稍候...",    
					"sLengthMenu" : "显示 _MENU_ 条",    
					"sZeroRecords" : "没有您要搜索的内容",    
					"sInfo" : "从 _START_ 到  _END_  共 _TOTAL_ 条",    
					"sInfoEmpty" : "记录数为0",    
					"sInfoFiltered" : "(全部记录数 _MAX_ 条)",    
					"sInfoPostFix" : "",    
					"sSearch" : "查询",
					"sUrl" : "",    
					"oPaginate": {    
						"sFirst" : "首页",    
						"sPrevious" : "<<",    
						"sNext" : ">>",    
						"sLast" : "尾页"    
					}
		    	}    	
			});		
	}
	function inittable(){
      table=$('#table_infos').DataTable({
    	"pagingType":   "full",
		'pageLength' : 10,
		'lengthChange' : false,
		'searching' : false,
		'info' : true,
		'autoWidth' : false,
	  	"bDestroy":true,
   		"bRetrieve":true,   		 
   		"select": {
   	        style: 'single',
   	        info: ''
   	    },   	   
   	    "sort": true,
   	 	//"order": [1,'asc'],  	
	  	"aoColumnDefs":[{"bSortable": false,"aTargets":[1,2,3]}],
	  	"ajax": "supply_department_manager/datas",
	  	"columns": [
	  		{ "data": "id"},
	  		{ "data": "junqu_code"},
            { "data": "junqu"},
            { "data": "flag"}/* ,
            { "data": "biaozhi"},
            { "data": "paixu"} */
        ],
    	"oLanguage": { //国际化配置  
			"sProcessing" : "正在获取数据，请稍后...",    
			"sLengthMenu" : "显示 _MENU_ 条",    
			"sZeroRecords" : "没有您要搜索的内容",    
			"sInfo" : "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",    
			"sInfoEmpty" : "记录数为0",    
			"sInfoFiltered" : "(全部记录数 _MAX_ 条)",    
			"sInfoPostFix" : "",    
			"sSearch" : "查询",
			"sUrl" : "",    
			"oPaginate": {    
				"sFirst" : "首页",    
				"sPrevious" : "<<",    
				"sNext" : ">>",    
				"sLast" : "尾页"    
			}
    	}    	
	});
	}
    function loadList(){
    	$.ajax({
    		url:"supply_department_manager/getunuse",
    		type: 'get',    		
    		success:function(data){
    			$("#junqu_select option").remove();
    			junqu=$("#junqu_select");
    			junqu.append("<option value='all'>请选择军区</option>"); 
    			data.forEach(function(e){
    				junqu.append("<option value='"+e.junqu_code+"'>"+e.junqu+"</option>");
    			})
			}
    	});	
    }
    loadList();
    inittable();
    init_recv();
    //添加一条记录
    $('#addRow').on('click',function(){
    	var junqucode=$("#junqu_select").val();
    	if(junqucode=='all'){
    		alert('请选择军区');
    		return;
    	}
    	$.ajax({
    		url:"supply_department_manager/edit",
    		type: 'post',
    		data:{"action":"add","junqu_code":junqucode},
    		success:function(result){
				alert(result);
				//table.draw( true );
				loadtable();
				loadList();
				//table.draw(true);
			}
    	});
    });
    //删除一条记录
    $('#delRow').on('click',function(){
       	var code;
    	var name;
    	var rows=$("#table_infos").find(".selected").children('td');
   	
    	rows.each(function(j){
    		switch(j){    		
    		case 1: code=$(this).text();break;
    		case 2: name=$(this).text();break;
    		}
    	});
    	if(code==null){
    		alert('请选择一行');
    	}
    	$.ajax({
    		url:"supply_department_manager/edit",
    		type: 'post',
    		data:{"action":"del","junqu_code":code},
    		success:function(data){
				alert(data);
				//table.row('.selected').remove().draw( false );
				loadList();
				loadtable();
				//loadtable();
			}
    	});
    	
    	/* alert(res+'111111111');
    	//if(result=="success")
    		table.row('.selected').remove().draw( true );
    	//table.reload(); */
    });
})
</script>
</body>
</html>
