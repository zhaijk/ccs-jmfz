<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:score="http://thymeleafexamples">
<head>
  <meta charset="utf-8">
  <title>打印报表</title>


</head>

<body onload="loadxml()">
<!-- <table width="70%" height="280px" style="position:relative;left:15%">
<tr>
<td>
<button class="btn btn-lg btn-info" onclick="printPreview();">打印</button>
<button class="btn btn-lg btn-info" onclick="save();" >保存到Excel</button>
</td>
</tr>
<tr>
<td> -->
<div class="row">
<div class="col-md-2">
<div class="col-md-6">
<button class="btn btn-info btn-lg" onclick="printPreview();">打——印</button>
</div>

<div class="col-md-6">
<button class="btn btn-info btn-lg" onclick="save();" >保存Excel</button>

</div>
</div>
<div class="col-md-9" style="height:240px">
<object   classid="clsid:D0CB6A0C-E656-4BF4-BD2D-6AE5EC183D7C" id="EtCell" 
	CODEBASE='ATGrid.CAB#version=2,1,8,411' width="100%" height="100%">
  <param name="Border3D" value="false">
  <param name='Ruler' value='false'>
  <param name='ETChart' value='false'>
  <param name="Ruler" value="false">
  <param name='ReadOnly' value='true'>
  <param name="FileName" th:value="${pa_th}">  
  <!-- <param name="DataSource" th:value="${xm_l}">  -->
</object>
</div>
</div>
<!-- </td>
</tr>


</table> -->

<textarea rows="2" name="ATGridData" cols="20" style='display:none'>
    <th:block th:text="${xm_l}" ></th:block>
</textarea>
 <script language="JavaScript">
function NoInstall()
{
    var str="你必须首先安装ATGrid报表插件,才能进行WEB自定义报表设计!\n";
    str +="\n\n安装方法：在刚才弹出的\"安全设置警告\"对话中选择\"是(Y)\"";
    str +="\n\n那么将会自动安装ATGrid插件!\n\n";
    str +="\n\n可以重新返回上面的URL网址进行安装!\n\n谢谢合作!!!!!\n\n";
    alert(str);
    //window.location.href = "http://www.etcell.com/";
}

function printPreview(){
var a = 1;
if(a==1){
	//alert('abc');

	EtCell.PrintPreviewEx("print-margin-top:60;print-margin-left:170;");
}else{
EtCell.PrintPreview();
}
	
}
function printPreview1(){
	//alert('abc');
	EtCell.PrintPreview();

	
}
var i=1;
function loadxml(){
	//alert(1);
   var strXML = ATGridData.value;
   //alert(2);
　　EtCell.ImportXML(strXML);
   //setupdisplay();
   //alert(3);
   EtCell.Redraw();
   //alert(4);
}



function setupdisplay()
{
	//在ETSet数据集中，如果在xml中写了字段数据
	//那么虽然不显示，但是已经在ETSet数据集中存在了
	//通过下面的脚本让隐藏字段显示上指定的列上
	//这样就实现了交叉报表的功能
	var ppETSet3 = EtCell.GetETSet("ETSet3");
	var ppETSet1 = EtCell.GetETSet("ETSet1");
	var ppETSet2 = EtCell.GetETSet("ETSet2");
	var ppETSet4 = EtCell.GetETSet("ETSet4");	
	console.info(ppETSet3);
	ppETSet3.MoveFirst();
	for(ii=0;ii<ppETSet3.GetRecordCount();ii++)
	{
		strFldKey = ppETSet3.GetFieldValue("FldKey");
		ppCell = ppETSet3.GetFieldCell("Field1");
		
		//通过下面的脚本让隐藏字段显示上指定的列上
		ppETSet1.SetFieldProperty(strFldKey,"BindCol",ppCell.Col);
		ppETSet2.SetFieldProperty(strFldKey,"BindCol",ppCell.Col);
		ppETSet4.SetFieldProperty(strFldKey,"BindCol",ppCell.Col);
		
		ppETSet3.MoveNext();
	}
}

function setKey(){
  //在ETSet数据集中，如果在xml中写了字段数据
  //那么虽然不显示，但是已经在ETSet数据集中存在了
  //通过下面的脚本让隐藏字段显示上指定的列上
  //这样就实现了交叉报表的功能
  var ppETSet2 = EtCell.GetETSet("ETSet2");
  var ppETSet1 = EtCell.GetETSet("ETSet1");
  ppETSet2.MoveFirst();
  for(ii=0;ii<ppETSet2.GetRecordCount();ii++)
  {
    
    //通过下面的脚本让隐藏字段显示上指定的列上
    strFldKey = ppETSet2.GetFieldValue("FldKey");
  
    ppCell = ppETSet2.GetFieldCell("实物");
    ppETSet1.SetFieldProperty(strFldKey,"BindCol",ppCell.Col);
   
    ppCell2 = ppETSet2.GetFieldCell("价拨");
    ppETSet1.SetFieldProperty(strFldKey+'_价拨',"BindCol",ppCell2.Col);
    ppETSet2.MoveNext();
  }

}

function save(){
	var pathname = EtCell.ShowDlgOpenFile('','*.xls',false);
	if(pathname!=''){
		if(EtCell.SaveAs(pathname)){
			alert('保存成功');
		}
	}
}
loadxml();
</script>
</body>
</html>
