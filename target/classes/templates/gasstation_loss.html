<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" xmlns:score="http://thymeleafexamples">
<head>
  <meta charset="utf-8">
  <title>油料损耗</title>
  <!-- Bootstrap 3.3.7 -->
  <link rel="stylesheet" href="css/bootstrap.min.css">
  <!-- Ionicons -->
  <link rel="stylesheet" href="css/ionicons.min.css">
  <link rel="stylesheet" href="css/bootstrap-table.min.css">  
  <link rel="stylesheet" href="css/bootstrap-editable.css" /> 
  <!-- DataTables -->
  <link rel="stylesheet" href="css/dataTables.bootstrap.min.css">  
  <link rel="stylesheet" href="css/buttons.bootstrap.min.css">
  <link rel="stylesheet" href="css/select.bootstrap.min.css">
  <!-- Theme style -->
  <link rel="stylesheet" href="css/AdminLTE.min.css"> 
  <link rel="stylesheet" href="css/skins/skin-blue.min.css">

</head>
<body>	
<div class="row">
<div class="col-md-12">
<div class="box">
  <div class="box-body with-border">
    <div id="toolbar" class="btn-group" style="font-size:24px;position:relative;top:30px;">	
	  <button id="addRow" type="button"  class="btn  btn-default">
		<span class="glyphicon glyphicon-plus" aria-hidden="false"></span>新增
	  </button>
	  <button id="updateRow" type="button" class="btn  btn-default" disabled>
		<span class="glyphicon glyphicon-pencil" aria-hidden="true"></span>修改
	  </button>
	  <button id="deleteRow" type="button" class="btn  btn-default">
		<span class="glyphicon glyphicon-remove" aria-hidden="true"></span>删除
	  </button>	
	  <button id="confirmRow" type="button" class="btn  btn-default">
		<span class="glyphicon glyphicon-ok" aria-hidden="false"></span>确定
	  </button>	
    </div>
   	<span style="font-size:24px;position:relative;top:6px;left:16%">油料损耗管理</span>
	<p class="text-muted well well-sm" style="width:27%;position:absolute;top:-2px;left:53%">由于油料提运过程的损失以及自然损耗，上级调拨的指标和实际可供使用的油料不相等，通过录入损耗数量，减少可供转换使用的指标，保持数据平衡。</p>
    <table id="car_infos" class="table table-hover table-stripe table-bordered table-condensed">
    <thead>
	  <tr style="font-size:16px;background-color:rgb(237, 241, 244);align:center">
		<th style="width:6%">序号</th>
		<th style="width:7%">日期</th>
		<th style="width:6%">油品</th>		
		<th style="width:10%">实物损耗</th>	
		<th style="width:10%">价拨损耗</th> 
		<th style="width:8%">密度</th>
		<th style="width:10%">季度</th>	
		<th style="width:10%">年度</th>
		<th style="width:10%">单位编码</th>
	  </tr>
    </thead>
    <tbody>  
    </tbody>
    </table>
</div>
</div>
</div>
</div>
  
<!-- jQuery 3 -->
<script src="js/jquery.min.js"></script>
<!-- Bootstrap 3.3.7 -->
<script src="js/bootstrap.min.js"></script>

<script src="js/bootstrap-editable.js"></script>
<script src="js/bootstrap-table.min.js"></script>
<script src="js/bootstrap-table-editable.min.js"></script>
<!-- DataTables -->
<script src="js/jquery.dataTables.min.js"></script>
<script src="js/dataTables.bootstrap.min.js"></script>

<script src="js/dataTables.buttons.min.js"></script>
<script src="js/buttons.bootstrap.min.js"></script>
<script src="js/dataTables.select.min.js"></script>

<script src="js/adminlte.min.js"></script>

<!-- SlimScroll -->
<script src="js/jquery.slimscroll.min.js"></script>
<!-- FastClick -->
<script src="js/fastclick.js"></script>
<!-- AdminLTE App -->
<script src="js/adminlte.min.js"></script>  
<!--[if lt IE 9]>
<script src="js/html5shiv.min.js"></script>
<script src="js/respond.min.js"></script>
<![endif]--> 
<script type='text/javascript' th:inline="javascript">
$(function(){	
	var cartypeinfo=[[${carTypeInfos}]];
	var departInfos=[[${departInfos}]];
	var array_car=new Array();
	var array_depart=new Array();
	for(i in cartypeinfo){
		//array_car[i]={name:cartypeinfo[i].autoCarType2,label:cartypeinfo[i].name};	
		array_car[i]={value:cartypeinfo[i].autoCarType2,text:cartypeinfo[i].name};
	}
	for(i in departInfos){
		//array_depart[i]={name:departInfos[i].departmentCode,label:departInfos[i].departmentName};	
		array_depart[i]={value:departInfos[i].departmentCode,text:departInfos[i].departmentName};	
	}
    var table=$('#car_infos').DataTable({
		'pageLength' : 10,
		'lengthChange' : false,
		'searching' : true,
		'info' : true,
		'autoWidth' : false,
	  	"bDestroy":true,
   		"bRetrieve":true,   		 
   		"select": {
   	        style: 'single',
   	        info: false
   	    },
	  	"ajax": "gasstation-loss-manager/datas",
	  	"columns": [
	  		{ "data": "id"},
	  		{ "data": "lossdate"},	  		 
            { "data": "oiltype" },
            { "data": "zhugongsunhao"},
            { "data": "jiabosunhao"},
            { "data": "density"},
            { "data": "jidu"  },
            { "data": "niandu"},
            { "data": "danweiid" }
        ],
    	"oLanguage": { //国际化配置  
			"sProcessing" : "正在获取数据，请稍后...",    
			"sLengthMenu" : "显示 _MENU_ 条",    
			"sZeroRecords" : "没有您要搜索的内容",    
			"sInfo" : "从 _START_ 到  _END_ 条记录 总记录数为 _TOTAL_ 条",    
			"sInfoEmpty" : "记录数为0",    
			"sInfoFiltered" : "(全部记录数 _MAX_ 条)",    
			"sInfoPostFix" : "",    
			"sSearch" : "搜索",
			"sUrl" : "",    
			"oPaginate": {    
				"sFirst" : "首页",    
				"sPrevious" : "<<",    
				"sNext" : ">>",    
				"sLast" : "尾页"    
			}
    	}
    	/* "createdRow":function(row,data,index){    		
    		$('td',row).eq(index).attr('class','input-cell');
    	} */
	});  
   /*  $("#car_infos").on("click","td",function(){
        var local=$(this);
        //local.css("background-color","gray"); 
        var value=local.text();
        var index=local.index();
        //alert(value+' '+index);
        switch(index){
        case 1:
        	local.editable({
        		//inputclass: "inputclass",
        		showbuttons:  false,
                type: "text",                //编辑框的类型。支持text|textarea|select|date|checklist等
                //title: "用户名",              //编辑框的标题
                //disabled: false,             //是否禁用编辑
                emptytext: value,          //空值的默认文本
                mode: "inline",              //编辑框的模式：支持popup和inline两种模式，默认是popup
                validate: function (value) { //字段验证
                    if (!$.trim(value)) {
                        return '不能为空';
                    }
                }});break; 
        case 2:
        	local.editable({      
        		showbuttons:  false,
                type: "select",                //编辑框的类型。支持text|textarea|select|date|checklist等
                title: "部门信息",              //编辑框的标题             
                source:array_depart,
                disabled: false,             //是否禁用编辑
                //text: value,
                //emptytext: value,          //空值的默认文本
                mode: "inline",              //编辑框的模式：支持popup和inline两种模式，默认是popup
                validate: function (value) { //字段验证
                    if (!$.trim(value)) {
                        return '不能为空';
                    }
                }});break; 
        case 3:
        	local.editable({          		 
                type: "select",                //编辑框的类型。支持text|textarea|select|date|checklist等
                title: "车辆品牌",              //编辑框的标题
                disabled: false,             //是否禁用编辑
                source:array_car,
                emptyvalue: value,          //空值的默认文本
                mode: "inline",              //编辑框的模式：支持popup和inline两种模式，默认是popup
                validate: function (value) { //字段验证
                    if (!$.trim(value)) {
                        return '不能为空';
                    }
                }});break; 
         case 4:
        	local.editable({          		 
                type: "text",                //编辑框的类型。支持text|textarea|select|date|checklist等
                title: "用户名",              //编辑框的标题
                disabled: false,             //是否禁用编辑
                emptytext: "空文本",          //空值的默认文本
                mode: "inline",              //编辑框的模式：支持popup和inline两种模式，默认是popup
                validate: function (value) { //字段验证
                    if (!$.trim(value)) {
                        return '不能为空';
                    }
                }});break;  
        case 5:
        	local.editable({          		 
                type: "text",                //编辑框的类型。支持text|textarea|select|date|checklist等
                title: "用户名",              //编辑框的标题
                disabled: false,             //是否禁用编辑
                emptytext: "空文本",          //空值的默认文本
                mode: "inline",              //编辑框的模式：支持popup和inline两种模式，默认是popup
                validate: function (value) { //字段验证
                    if (!$.trim(value)) {
                        return '不能为空';
                    }
                }});break; 
        case 6:
        	local.editable({          		 
                type: "text",                //编辑框的类型。支持text|textarea|select|date|checklist等
                title: "用户名",              //编辑框的标题
                disabled: false,             //是否禁用编辑
                emptytext: "空文本",          //空值的默认文本
                mode: "inline",              //编辑框的模式：支持popup和inline两种模式，默认是popup
                validate: function (value) { //字段验证
                    if (!$.trim(value)) {
                        return '不能为空';
                    }
                }});break;
        }
	}); */
    $('#addRow').on('click',function(){
    	table.rows.add([
    		{"id":0,
    		 "autoCarCode":"请输入车号",
    		 "passportName":0,
    		 "autoCarColor2":0,
    		 "autoCarType2":25,
    		 "carIdentify":null,
    		 "carBrand":null,
    		 "driverName":"请输入使用人",
    		 "departmentCode":"",
    		 "telephoneNumber":"请输入联系电话",
    		 "passportNumber":null,
    		 "fastDate":"",
    		 "operator":"0501",
    		 "tflag":0,
    		 "note2":null,
    		 "counter":0,
    		 "carBrandName":"请选择车辆类型",
    		 "departmentName":"请选择部门",
    		 "name":null}
        ])
        .draw();
    });
    $('#deleteRow').on('click',function(){
    	var rowdata=table.row('.selected').data();
    	console.info(rowdata.autoCarCode);
    	var result=confirm("确定删除"+rowdata.autoCarCode+"信息");
    	if(result==false) return;
    	$.ajax({
    		url:"car-manager/edit",
    		type: 'post',
    		data:{"action":"delete","autoCarCode":rowdata.autoCarCode,"id":rowdata.id},
    		success:function(result){
				alert(result);
			}
    	});
    	if(result==true)
    		table.row('.selected').remove().draw( false );
    });
    $('#updateRow').on('click',function(){
    	var tds=$("#car_infos").find(".selected").children('td');
    	var rowdata=table.row('.selected').data();
    	var autoCarCode;
    	var departmentCode;
    	var carBrand;
    	var pastDate;
    	var driverName;
    	var telephoneNumber;
    	tds.each(function(j){
    		switch(j){
    		case 1: autoCarCode=$(this).text();break;
    		case 2: departmentCode=$(this).text();break;
    		case 3: carBrand=$(this).text();break;
    		case 4: fastDate=$(this).text();break;
    		case 5: driverName=$(this).text();break;
    		case 6:	telephoneNumber=$(this).text();break;
    		}
    	});    	
    	var result=confirm("确定更新"+autoCarCode+"信息");
    	if(result==false) return;
    	$.ajax({
    		url:"car-manager/edit",
    		type: 'post',    		
    		data:{"action":"update",
    			  "autoCarCode":autoCarCode,
    			  "departmentCode":departmentCode,
    			  "carBrand":carBrand,
    			  "fastDate":fastDate,
    			  "driverName":driverName,
    			  "telephoneNumber":telephoneNumber,
    			  "name":rowdata.autoCarCode},
    		success:function(result){
				alert(result);
			}
    	});
    });
    $('#confirmRow').on('click',function(){
    	var tds=$("#car_infos").find(".selected").children('td');
    	var rowdata=table.row('.selected').data();
    	var autoCarCode;
    	var departmentCode;
    	var carBrand;
    	var pastDate;
    	var driverName;
    	var telephoneNumber;
    	tds.each(function(j){
    		switch(j){
    		case 1: autoCarCode=$(this).text();break;
    		case 2: departmentCode=$(this).text();break;
    		case 3: carBrand=$(this).text();break;
    		case 4: fastDate=$(this).text();break;
    		case 5: driverName=$(this).text();break;
    		case 6:	telephoneNumber=$(this).text();break;
    		}
    	});   	
    	console.info(departmentCode);
    	if(autoCarCode=='请输入车号'){
    		alert("请输入车号");
    		return false;
    	}else if(departmentCode=='请选择部门'){
    		alert("请选择部门");
    		return false;
    	}else if(carBrand=='请选择车辆类型'){
    		alert("请选择车辆类型");
    		return false;
    	}else if(driverName=='请输入使用人'){
    		alert("请输入使用人");
    		return false;
    	}else if(telephoneNumber=='请输入联系电话'){
    		alert("请输入联系电话");
    		return false;
    	}
    	
    	//console.info(rowdata.autoCarCode);
    	var result=confirm("确定添加"+autoCarCode+"信息");
    	if(result==false) return ;
    	$.ajax({
    		url:"car-manager/edit",
    		type: 'post',
    		data:{"action":"insert",
  			  "autoCarCode":autoCarCode,
  			  "departmentCode":departmentCode,
  			  "carBrand":carBrand,
  			  "fastDate":fastDate,
  			  "driverName":driverName,
  			  "telephoneNumber":telephoneNumber,
  			  "name":rowdata.autoCarCode
  			},
  			success:function(result){
				alert(result);
			},
			error:function(XMLHttpRequest, textStatus, errorThrown){
				alert(XMLHttpRequest.status); 
				alert(XMLHttpRequest.readyState); 
				alert(textStatus); 
			}
    	});    	
    });
})
</script>
</body>
</html>
